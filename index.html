<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Curricular de Dafne</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      transition: background 0.3s;
    }
    h1 {
      text-align: center;
      color: #0078d7;
      transition: color 0.3s;
      cursor: pointer;
    }
    .color-picker {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .color-picker label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    #niveles {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .nivel {
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 10px;
      width: 220px;
      transition: background 0.3s;
    }
    .nivel h2 {
      text-align: center;
      font-size: 16px;
      margin-bottom: 10px;
      background: #0078d7;
      color: white;
      padding: 5px 0;
      border-radius: 4px;
      cursor: pointer;
    }
    .ramo {
      margin: 5px 0;
      padding: 6px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 13px;
      text-align: center;
      position: relative;
      user-select: none;
    }
    .ramo::after {
      content: attr(data-nota);
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 11px;
      color: #fff;
    }
    .resumen, .acciones {
      text-align: center;
      margin-top: 20px;
    }
    .resumen p {
      font-size: 15px;
      margin: 5px;
    }
    .resumen strong {
      font-size: 16px;
    }
    button {
      padding: 8px 12px;
      margin: 10px 5px 5px 5px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular de Dafne ‚Äî Para que sea la mejor matrona del mundo üë∂üèºüíñ</h1>

  <div class="color-picker">
    <label>Aprobado <input type="color" id="color-aprobado"></label>
    <label>Reprobado <input type="color" id="color-reprobado"></label>
    <label>Cursando <input type="color" id="color-cursando"></label>
    <label>No cursado <input type="color" id="color-nocursado"></label>
  </div>

  <div id="niveles"></div>

  <div class="resumen">
    <p>Aprobados: <span id="aprobados">0</span></p>
    <p>Reprobados: <span id="reprobados">0</span></p>
    <p>Cursando: <span id="cursando">0</span></p>
    <p>No cursado: <span id="nocursado">0</span></p>
    <p><strong>Avance total:</strong> <span id="avance">0%</span></p>
    <p><strong>Promedio general:</strong> <span id="promedioGeneral">0</span></p>
  </div>

  <div class="acciones">
    <button onclick="resetearMalla()">Resetear malla</button>
  </div>

  <!-- Input oculto para ruedas de color din√°micas -->
  <input type="color" id="colorPickerHidden" style="position:absolute; left:-9999px;">

  <script>
    const estados = ["aprobado", "reprobado", "cursando", "nocursado"];
    const malla = [
      { nivel: 1, ramos: ["Morfolog√≠a I", "Ciencias Biol√≥gicas y Qu√≠micas", "M√≥dulo Gesti√≥n en Salud I", "Rol de la Matrona en la Sociedad"] },
      { nivel: 2, ramos: ["Fundamentos Biol√≥gicos I", "Morfolog√≠a II", "M√≥dulo Gesti√≥n en Salud II", "Electivo Cultural", "Atenci√≥n de Salud Integral a la Mujer"] },
      { nivel: 3, ramos: ["Fundamentos Biol√≥gicos II", "Embriolog√≠a y Gen√©tica", "M√≥dulo Gesti√≥n en Salud III", "Puerperio y Salud P√∫blica"] },
      { nivel: 4, ramos: ["Fundamentos Biol√≥gicos III", "M√≥dulo Gesti√≥n en Salud IV", "Electivo Cultural II", "Promoci√≥n de la Salud, Control Prenatal y Salud P√∫blica"] },
      { nivel: 5, ramos: ["Atenci√≥n Primaria y Ginecolog√≠a Preventiva", "M√≥dulo Gesti√≥n en Matroner√≠a I"] },
      { nivel: 6, ramos: ["Salud Sexual, Planificaci√≥n Familiar", "M√≥dulo Gesti√≥n en Matroner√≠a II"] },
      { nivel: 7, ramos: ["Obstetricia Preventiva I", "M√≥dulo Gesti√≥n en Matroner√≠a III"] },
      { nivel: 8, ramos: ["Obstetricia Preventiva II", "Seminario Proyecto de Gesti√≥n o Investigaci√≥n"] },
      { nivel: 9, ramos: ["Pr√°ctica Profesional Controlada I"] },
      { nivel: 10, ramos: ["Pr√°ctica Profesional Controlada II"] }
    ];

    const colorPickerHidden = document.getElementById("colorPickerHidden");

    function crearMalla() {
      const container = document.getElementById("niveles");
      container.innerHTML = "";
      malla.forEach(n => {
        const nivel = document.createElement("div");
        nivel.className = "nivel";
        nivel.innerHTML = `<h2>Nivel ${n.nivel}</h2>`;
        n.ramos.forEach(r => {
          const ramo = document.createElement("div");
          ramo.className = "ramo";
          ramo.textContent = r;
          ramo.dataset.nombre = `nivel${n.nivel}-${r}`;
          ramo.onclick = cambiarEstado;
          nivel.appendChild(ramo);
        });
        container.appendChild(nivel);
      });
    }

    function cambiarEstado(e) {
      const div = e.target;
      const nombre = div.dataset.nombre;
      let estadoActual = localStorage.getItem(nombre) || "nocursado";
      let index = estados.indexOf(estadoActual);
      let nuevoEstado = estados[(index + 1) % estados.length];
      div.className = "ramo " + nuevoEstado;
      localStorage.setItem(nombre, nuevoEstado);
      actualizarResumen();
      aplicarColores();
    }

    function cargarEstados() {
      document.querySelectorAll(".ramo").forEach(div => {
        let estado = localStorage.getItem(div.dataset.nombre) || "nocursado";
        div.classList.add(estado);
      });
    }

    function actualizarResumen() {
      let contadores = { aprobado: 0, reprobado: 0, cursando: 0, nocursado: 0 };
      document.querySelectorAll(".ramo").forEach(r => {
        estados.forEach(est => {
          if (r.classList.contains(est)) contadores[est]++;
        });
      });
      let total = Object.values(contadores).reduce((a, b) => a + b, 0);
      document.getElementById("aprobados").textContent = contadores.aprobado;
      document.getElementById("reprobados").textContent = contadores.reprobado;
      document.getElementById("cursando").textContent = contadores.cursando;
      document.getElementById("nocursado").textContent = contadores.nocursado;
      let porcentaje = ((contadores.aprobado / total) * 100).toFixed(1);
      document.getElementById("avance").textContent = isNaN(porcentaje) ? "0%" : porcentaje + "%";
      document.getElementById("promedioGeneral").textContent = "0";
    }

    function aplicarColores() {
      estados.forEach(estado => {
        const color = document.getElementById("color-" + estado).value;
        localStorage.setItem("color-" + estado, color);
        document.querySelectorAll("." + estado).forEach(elem => {
          elem.style.background = color;
        });
      });
    }

    function cargarColores() {
      const porDefecto = {
        aprobado: "#1abc9c",
        reprobado: "#e74c3c",
        cursando: "#3498db",
        nocursado: "#bdc3c7"
      };
      estados.forEach(estado => {
        const picker = document.getElementById("color-" + estado);
        picker.value = localStorage.getItem("color-" + estado) || porDefecto[estado];
        picker.oninput = aplicarColores;
      });
      aplicarColores();
    }

    function resetearMalla() {
      document.querySelectorAll(".ramo").forEach(r => {
        localStorage.setItem(r.dataset.nombre, "nocursado");
        r.className = "ramo nocursado";
      });
      actualizarResumen();
      aplicarColores();
    }

    function aplicarExtras() {
      const fondo = localStorage.getItem("color-fondo-pagina");
      if (fondo) document.body.style.background = fondo;

      const colorTitulo = localStorage.getItem("color-titulo");
      if (colorTitulo) document.querySelector("h1").style.color = colorTitulo;

      document.querySelectorAll(".nivel").forEach(nivel => {
        const h2 = nivel.querySelector("h2");
        const colorNivel = localStorage.getItem("nivel-" + h2.textContent.trim());
        if (colorNivel) {
          nivel.style.background = colorNivel;
        }
      });
    }

    // Doble clic en fondo
    document.body.addEventListener("dblclick", (e) => {
      if (e.target === document.body) {
        colorPickerHidden.oninput = () => {
          document.body.style.background = colorPickerHidden.value;
          localStorage.setItem("color-fondo-pagina", colorPickerHidden.value);
        };
        colorPickerHidden.click();
      }
    });

    // Doble clic en t√≠tulo principal
    document.querySelector("h1").addEventListener("dblclick", () => {
      colorPickerHidden.oninput = () => {
        document.querySelector("h1").style.color = colorPickerHidden.value;
        localStorage.setItem("color-titulo", colorPickerHidden.value);
      };
      colorPickerHidden.click();
    });

    // Doble clic en t√≠tulo de nivel
    document.addEventListener("dblclick", e => {
      if (e.target.tagName === "H2" && e.target.parentElement.classList.contains("nivel")) {
        const nivelDiv = e.target.parentElement;
        colorPickerHidden.oninput = () => {
          nivelDiv.style.background = colorPickerHidden.value;
          localStorage.setItem("nivel-" + e.target.textContent.trim(), colorPickerHidden.value);
        };
        colorPickerHidden.click();
      }
    });

    window.onload = () => {
      crearMalla();
      cargarEstados();
      actualizarResumen();
      cargarColores();
      aplicarExtras();
    };
  </script>
</body>
</html>
